{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/ai4ci/notebooks/optimal-stopping-point/osp_model.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"d5a8d097-9ace-5688-bcb0-b6a357dcd48a >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Optimal Stopping Point for CI Tests</h1>\n<p>One of the machine learning explorations within the OpenShift CI Analysis project is predicting optimal stopping point for CI tests based on their test duration (runtimes) (see this <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/issues/226\">issue</a> for more details). In a previous <a href=\"../data-sources/TestGrid/metrics/time_to_fail.ipynb\">notebook</a> we showed how to access the TestGrid data, and then performed initial data analysis as well as feature engineering on it. Furthermore, we also calculated the optimal stopping point by identifying the distribution of the <code>test_duration</code> values for different CI tests and comparing the distributions of passing/failing tests.</p>\n<p>In this notebook, we will detect the optimal stopping point for different CI tests taken as inputs.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Import libraries</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> gzip\n<span class=\"token\" style=\"color:#0000ff\">import</span> json\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> itertools\n<span class=\"token\" style=\"color:#0000ff\">import</span> scipy  <span class=\"token\" style=\"color:#008000;font-style:italic\"># noqa F401</span>\n<span class=\"token\" style=\"color:#0000ff\">from</span> scipy<span class=\"token\" style=\"color:#393A34\">.</span>stats <span class=\"token\" style=\"color:#0000ff\">import</span> <span class=\"token\" style=\"color:#393A34\">(</span>  <span class=\"token\" style=\"color:#008000;font-style:italic\"># noqa F401</span>\n    invgauss<span class=\"token\" style=\"color:#393A34\">,</span>\n    lognorm<span class=\"token\" style=\"color:#393A34\">,</span>\n    pearson3<span class=\"token\" style=\"color:#393A34\">,</span>\n    weibull_min<span class=\"token\" style=\"color:#393A34\">,</span>\n    triang<span class=\"token\" style=\"color:#393A34\">,</span>\n    beta<span class=\"token\" style=\"color:#393A34\">,</span>\n    norm<span class=\"token\" style=\"color:#393A34\">,</span>\n    weibull_max<span class=\"token\" style=\"color:#393A34\">,</span>\n    uniform<span class=\"token\" style=\"color:#393A34\">,</span>\n    gamma<span class=\"token\" style=\"color:#393A34\">,</span>\n    expon<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> ipynb<span class=\"token\" style=\"color:#393A34\">.</span>fs<span class=\"token\" style=\"color:#393A34\">.</span>defs<span class=\"token\" style=\"color:#393A34\">.</span>osp_helper_functions <span class=\"token\" style=\"color:#0000ff\">import</span> <span class=\"token\" style=\"color:#393A34\">(</span>\n    CephCommunication<span class=\"token\" style=\"color:#393A34\">,</span>\n    fit_distribution<span class=\"token\" style=\"color:#393A34\">,</span>\n    standardize<span class=\"token\" style=\"color:#393A34\">,</span>\n    filter_test_type<span class=\"token\" style=\"color:#393A34\">,</span>\n    fetch_all_tests<span class=\"token\" style=\"color:#393A34\">,</span>\n    best_distribution<span class=\"token\" style=\"color:#393A34\">,</span>\n    optimal_stopping_point<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">import</span> warnings\n\nwarnings<span class=\"token\" style=\"color:#393A34\">.</span>filterwarnings<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;ignore&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Ceph</h2>\n<p>Connection to Ceph for importing the TestGrid data</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Specify variables</span>\nMETRIC_NAME <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;time_to_fail&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify the path for input grid data</span>\nINPUT_DATA_PATH <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../data/raw/testgrid_258.json.gz&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify the path for output metric data</span>\nOUTPUT_DATA_PATH <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;../../../../data/processed/metrics/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>METRIC_NAME<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## CEPH Bucket variables</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\">## Create a .env file on your local with the correct configs</span>\ns3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ENDPOINT&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_access_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_ACCESS_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_secret_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_SECRET_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_bucket <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_BUCKET&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_path <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;S3_PROJECT_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;metrics&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\ns3_input_data_path <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;raw_data&quot;</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Specify whether or not we are running this as a notebook or part of an automation pipeline.</span>\nAUTOMATION <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\">## Import data</span>\ntimestamp <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>today<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> AUTOMATION<span class=\"token\" style=\"color:#393A34\">:</span>\n    filename <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;testgrid_</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>day<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>timestamp<span class=\"token\" style=\"color:#393A34\">.</span>month<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.json&quot;</span></span>\n    cc <span class=\"token\" style=\"color:#393A34\">=</span> CephCommunication<span class=\"token\" style=\"color:#393A34\">(</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span> s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span> s3_bucket<span class=\"token\" style=\"color:#393A34\">)</span>\n    s3_object <span class=\"token\" style=\"color:#393A34\">=</span> cc<span class=\"token\" style=\"color:#393A34\">.</span>s3_resource<span class=\"token\" style=\"color:#393A34\">.</span>Object<span class=\"token\" style=\"color:#393A34\">(</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>s3_input_data_path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>filename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    file_content <span class=\"token\" style=\"color:#393A34\">=</span> s3_object<span class=\"token\" style=\"color:#393A34\">.</span>get<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>read<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>decode<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;utf-8&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    testgrid_data <span class=\"token\" style=\"color:#393A34\">=</span> json<span class=\"token\" style=\"color:#393A34\">.</span>loads<span class=\"token\" style=\"color:#393A34\">(</span>file_content<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">with</span> gzip<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">open</span><span class=\"token\" style=\"color:#393A34\">(</span>INPUT_DATA_PATH<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;rb&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> read_file<span class=\"token\" style=\"color:#393A34\">:</span>\n        testgrid_data <span class=\"token\" style=\"color:#393A34\">=</span> json<span class=\"token\" style=\"color:#393A34\">.</span>load<span class=\"token\" style=\"color:#393A34\">(</span>read_file<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Fetch all tests</h2>\n<p>Using the function <code>fetch_all_tests</code>, we will fetch all passing and failing tests into two dataframes.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Fetch all failing tests i.e which have a status code of 12</span>\nfailures_df <span class=\"token\" style=\"color:#393A34\">=</span> fetch_all_tests<span class=\"token\" style=\"color:#393A34\">(</span>testgrid_data<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">12</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">failures_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>failure/passing</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>8</th>\n      <td>2021-08-16 23:03:14</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>20.016667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>10</th>\n      <td>2021-08-16 00:01:05</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>108.233333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>22</th>\n      <td>2021-08-16 23:03:14</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>13.166667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>24</th>\n      <td>2021-08-16 00:01:05</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>operator.Run multi-stage test e2e-metal-assist...</td>\n      <td>89.983333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>38</th>\n      <td>2021-08-16 00:01:05</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>TestInstall_test_install.start_install_and_wai...</td>\n      <td>60.004001</td>\n      <td>True</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Fetch all passing tests i.e which have a status code of 1</span>\npassing_df <span class=\"token\" style=\"color:#393A34\">=</span> fetch_all_tests<span class=\"token\" style=\"color:#393A34\">(</span>testgrid_data<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">passing_df<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>failure/passing</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>1</th>\n      <td>2021-08-23 00:01:04</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>95.300000</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2021-08-22 08:53:17</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>101.800000</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2021-08-20 23:21:32</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>134.833333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2021-08-20 15:57:36</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>109.833333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>2021-08-20 06:47:40</td>\n      <td>\"redhat-assisted-installer\"</td>\n      <td>periodic-ci-openshift-release-master-nightly-4...</td>\n      <td>Overall</td>\n      <td>94.800000</td>\n      <td>True</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Filter tests</h2>\n<p>After collecting the data for all passing and failing tests, we will move towards narrowing down to one test for which we would want to calculate the optimal stopping point. We will be using the test - <code>operator.Run multi-stage test e2e-aws-upgrade - e2e-aws-upgrade-openshift-e2e-test container test</code> and extract the data for this test.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">failures_test <span class=\"token\" style=\"color:#393A34\">=</span> filter_test_type<span class=\"token\" style=\"color:#393A34\">(</span>\n    failures_df<span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;operator.Run multi-stage test e2e-aws-upgrade - e2e-aws-upgrade-openshift-e2e-test container test&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\nfailures_test<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>failure/passing</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2021-08-25 12:17:53</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>85.866667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2021-08-25 10:30:05</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>91.916667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2021-08-25 04:41:24</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>101.133333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2021-08-24 20:03:02</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>98.450000</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2021-08-24 04:35:23</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>93.216667</td>\n      <td>True</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">passing_test <span class=\"token\" style=\"color:#393A34\">=</span> filter_test_type<span class=\"token\" style=\"color:#393A34\">(</span>\n    passing_df<span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;operator.Run multi-stage test e2e-aws-upgrade - e2e-aws-upgrade-openshift-e2e-test container test&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\npassing_test<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>timestamp</th>\n      <th>tab</th>\n      <th>grid</th>\n      <th>test</th>\n      <th>test_duration</th>\n      <th>failure/passing</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2021-08-25 13:06:02</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>101.250000</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2021-08-25 07:15:39</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>94.283333</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2021-08-25 06:08:52</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>90.316667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2021-08-25 02:54:53</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>93.866667</td>\n      <td>True</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2021-08-24 22:40:00</td>\n      <td>\"redhat-openshift-informing\"</td>\n      <td>release-openshift-okd-installer-e2e-aws-upgrade</td>\n      <td>operator.Run multi-stage test e2e-aws-upgrade ...</td>\n      <td>92.900000</td>\n      <td>True</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Fit Distribution</h2>\n<p>After extracting the data for one test, we would want to find the best distribution to perform optimal stopping point calculation. We find chi square and p-values to find the best distribution.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">failure_dist<span class=\"token\" style=\"color:#393A34\">,</span> failures_r <span class=\"token\" style=\"color:#393A34\">=</span> fit_distribution<span class=\"token\" style=\"color:#393A34\">(</span>failures_test<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test_duration&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.99</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.01</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>\nDistributions listed by Betterment of fit:\n............................................\n   Distribution     chi_square and p-value\n3          beta  (2148.0315961744586, 0.0)\n9      pearson3   (2150.964892187448, 0.0)\n1          norm   (2178.439189095538, 0.0)\n8       lognorm   (2190.171386750302, 0.0)\n6         gamma  (2251.5768352345144, 0.0)\n0   weibull_min  (2335.2881528000057, 0.0)\n2   weibull_max  (2436.7340969950874, 0.0)\n4      invgauss  (2581.7529201615253, 0.0)\n10       triang   (3168.817214371956, 0.0)\n5       uniform  (5205.7686822999685, 0.0)\n7         expon   (7308.400793415922, 0.0)\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Identify the best fit distribution from the failing test along with its corresponding distribution parameters</span>\nbest_dist<span class=\"token\" style=\"color:#393A34\">,</span> parameters_failing <span class=\"token\" style=\"color:#393A34\">=</span> best_distribution<span class=\"token\" style=\"color:#393A34\">(</span>failure_dist<span class=\"token\" style=\"color:#393A34\">,</span> failures_r<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Identify the distributions for the passing test along with its corresponding distribution parameters</span>\npassing_dist<span class=\"token\" style=\"color:#393A34\">,</span> passing_r <span class=\"token\" style=\"color:#393A34\">=</span> fit_distribution<span class=\"token\" style=\"color:#393A34\">(</span>passing_test<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test_duration&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.99</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.01</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>\nDistributions listed by Betterment of fit:\n............................................\n   Distribution                         chi_square and p-value\n10       triang     (461.9624452114939, 4.799796517458444e-69)\n3          beta    (619.2886679176573, 2.716009412709153e-100)\n2   weibull_max   (782.1495727872282, 2.4780499811803997e-133)\n5       uniform   (800.7205543332755, 3.9377128547833523e-137)\n9      pearson3     (902.4903827437414, 4.87937692523532e-158)\n0   weibull_min   (961.9366558978377, 2.6033191498811774e-170)\n6         gamma   (1025.0253918219983, 2.234474698949537e-183)\n8       lognorm  (1063.4355506988115, 2.3726995807065007e-191)\n1          norm    (1066.204889931689, 6.306900543032179e-192)\n4      invgauss     (1076.96978515332, 3.650894820526847e-194)\n7         expon                      (2457.1474484587093, 0.0)\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[13]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">passing_r<span class=\"token\" style=\"color:#393A34\">.</span>head<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><div><div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>Distribution</th>\n      <th>chi_square and p-value</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>10</th>\n      <td>triang</td>\n      <td>(461.9624452114939, 4.799796517458444e-69)</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>beta</td>\n      <td>(619.2886679176573, 2.716009412709153e-100)</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>weibull_max</td>\n      <td>(782.1495727872282, 2.4780499811803997e-133)</td>\n    </tr>\n    <tr>\n      <th>5</th>\n      <td>uniform</td>\n      <td>(800.7205543332755, 3.9377128547833523e-137)</td>\n    </tr>\n    <tr>\n      <th>9</th>\n      <td>pearson3</td>\n      <td>(902.4903827437414, 4.87937692523532e-158)</td>\n    </tr>\n  </tbody>\n</table>\n</div></div></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[14]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Identify the best fit distribution from the passing test</span>\nbest_distribution<span class=\"token\" style=\"color:#393A34\">(</span>passing_dist<span class=\"token\" style=\"color:#393A34\">,</span> passing_r<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>(&#x27;weibull_min&#x27;, [12.20521715428722, -9.947987307617899, 10.381897325624372])</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>After finding the best distribution for failing distribution, we find the corresponding parameters for the same distribution in the passing distribution. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[15]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Find the corresponding passing test distribution parameters for the</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># best fit distribution identified from the failing test above</span>\nparameters_passing <span class=\"token\" style=\"color:#393A34\">=</span> passing_dist<span class=\"token\" style=\"color:#393A34\">[</span>passing_dist<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Distribution Names&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> best_dist<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">[</span>\n    <span class=\"token\" style=\"color:#A31515\">&quot;Parameters&quot;</span>\n<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>values\nparameters_passing <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">list</span><span class=\"token\" style=\"color:#393A34\">(</span>itertools<span class=\"token\" style=\"color:#393A34\">.</span>chain<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">*</span>parameters_passing<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[16]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Standardize the features by removing the mean and scaling to unit variance</span>\ny_std_failing<span class=\"token\" style=\"color:#393A34\">,</span> len_y_failing<span class=\"token\" style=\"color:#393A34\">,</span> y_failing <span class=\"token\" style=\"color:#393A34\">=</span> standardize<span class=\"token\" style=\"color:#393A34\">(</span>\n    failures_test<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test_duration&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.99</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.01</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[17]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Standardize the features by removing the mean and scaling to unit variance</span>\ny_std_passing<span class=\"token\" style=\"color:#393A34\">,</span> len_y_passing<span class=\"token\" style=\"color:#393A34\">,</span> y_passing <span class=\"token\" style=\"color:#393A34\">=</span> standardize<span class=\"token\" style=\"color:#393A34\">(</span>\n    passing_test<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;test_duration&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.99</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">0.01</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Optimal Stopping Point Calculation</h2>\n<p>Let&#x27;s move forward to find the optimal stopping point for the test by passing the best distribution name, failing and passing distributions and the corresponding distribution parameters.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[18]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">osp <span class=\"token\" style=\"color:#393A34\">=</span> optimal_stopping_point<span class=\"token\" style=\"color:#393A34\">(</span>\n    best_dist<span class=\"token\" style=\"color:#393A34\">,</span>\n    y_std_failing<span class=\"token\" style=\"color:#393A34\">,</span>\n    y_failing<span class=\"token\" style=\"color:#393A34\">,</span>\n    parameters_failing<span class=\"token\" style=\"color:#393A34\">,</span>\n    y_std_passing<span class=\"token\" style=\"color:#393A34\">,</span>\n    y_passing<span class=\"token\" style=\"color:#393A34\">,</span>\n    parameters_passing<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[19]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Optimat Stopping Point for `operator.Run multi-stage test e2e-aws-upgrade</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># - e2e-aws-upgrade-openshift-e2e-test container test`</span>\nosp</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>104.3979969544608</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>This tells us that the optimal stopping point should be at test duration run length of 104.39 seconds.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Conclusion</h2>\n<p>In this notebook we were able to:</p>\n<ul>\n<li>Fetch the data for all passing and failing tests</li>\n<li>Filter the data for the test - <code>operator.Run multi-stage test e2e-aws-upgrade - e2e-aws-upgrade-openshift-e2e-test container test</code></li>\n<li>Find the best distribution for the test</li>\n<li>Find the optimal stopping point for the test</li>\n</ul></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/optimal-stopping-point/osp_model.ipynb"}}},"pageContext":{"id":"d5a8d097-9ace-5688-bcb0-b6a357dcd48a >>> JupyterNotebook"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}