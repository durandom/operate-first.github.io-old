{"componentChunkName":"component---src-templates-markdown-remark-js","path":"/data-science/ds-workflows/docs/serving_monitoring/deploy-models-using-seldon.md","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"markdownRemark":{"id":"d63a9f70-805e-5b53-b3e8-ba3aa66ff4cd","html":"<h1 id=\"deploy-models-on-openshift-using-seldon-server\" style=\"position:relative;\"><a href=\"#deploy-models-on-openshift-using-seldon-server\" aria-label=\"deploy models on openshift using seldon server permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Deploy models on OpenShift using Seldon Server</h1>\n<p>Have a model trained and ready to share with the world? In this guide, we go over how to deploy models as a microservice using one of Seldon Core’s pre-packaged <a href=\"https://docs.seldon.io/projects/seldon-core/en/v1.1.0/servers/overview.html\">model servers</a>.</p>\n<h2 id=\"pre-requisites\" style=\"position:relative;\"><a href=\"#pre-requisites\" aria-label=\"pre requisites permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Pre-requisites</h2>\n<ul class=\"pf-c-list\">\n<li>An ML model trained using one of these supported ML <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/nav/config/servers.html\">libraries</a> or a custom model (guide forthcoming) .</li>\n<li>OpenShift namespace with <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/workflow/install.html#openshift\">seldon operator installed</a> and administrator privileges available. (If you are using the <a href=\"https://console-openshift-console.apps.zero.massopen.cloud/\">Operate First cluster</a>, you can use the namespace <code class=\"language-text\">ds-ml-workflows-ws</code> which already has Seldon deployed).</li>\n</ul>\n<h2 id=\"steps-to-deploy\" style=\"position:relative;\"><a href=\"#steps-to-deploy\" aria-label=\"steps to deploy permalink\" class=\"anchor before\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Steps to deploy</h2>\n<ol class=\"pf-c-list\">\n<li>Save the model as a .joblib file and name it <code class=\"language-text\">model.joblib</code>. Push the model to S3 in its own directory. For example a path like <code class=\"language-text\">s3://&lt;bucket_name&gt;/&lt;project_name&gt;/&lt;model_name&gt;/model.joblib</code>.</li>\n<li>\n<p>On the OpenShift console:</p>\n<ul class=\"pf-c-list\">\n<li>\n<p>Ensure the Seldon-Core operator is installed in the namespace where you are deploying.</p>\n<ul class=\"pf-c-list\">\n<li>If you are using the <a href=\"https://console-openshift-console.apps.zero.massopen.cloud/\">Operate First cluster</a>, you can use the namespace <code class=\"language-text\">ds-ml-workflows-ws</code> which has Seldon deployed.</li>\n<li>To get access to this namespace, <a href=\"https://github.com/operate-first/support/issues/new/choose\">open an issue</a> on the operate-first/support repository.</li>\n</ul>\n</li>\n<li>In the namespace, add create a secret with the AWS credentials for access to the bucket. To create a Secret, go to <code class=\"language-text\">Workloads</code>, <code class=\"language-text\">Secrets</code>, click on <code class=\"language-text\">Create</code> and select <code class=\"language-text\">From YAML</code> in the dropdown menu. </li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1ebd495f50bd036839ab0cd5e4fec803/57f7d/create-secret.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 65.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAABYlAAAWJQFJUiTwAAACb0lEQVQ4y52TS08TURiGJ3HRQmlpp3Omw7QE6L20pVDoFJipAtG9MTG4IRENqMHEvVAKaEg0ujZpE+RiRIk/wcS1xi0bNu6McVEpadpiMa/nnAYFSlw4yZNvMosn73cZIdwbRzAcRY8viECoF8SlIre0gmKxiN3dXezt7aFUKqFaraJcLqNSqZxLrVbD0dERhGi8H339g/D6QyeEy/jfhwuTg9ofoay4sZhbxsdPn7G1vYPttzvY2trE+jpjAxubm1hbW0M+n0ehUOD1ReEl8uuv8erNOwisXZbQFwjDH4zASTown81hanoGdtWLrk4nROsFtLeZ4LCZYGk1wWQ2w0xpaWnh1WJphd3ejlg0CoGJkkNpsFmydyZcoMK7cw/QFexDJBZBtz8AX48KjypDUVxwuU6jKAo8Hg/S6TQV0la14VEq1fhy7CLBw/ksF3YG4ggldQRjCfh9nVAVCRKRIct/IYRwqaqq0DQNQm9fEpfGL1OpjgE6y25vAI8er+LW7BxPyxPJEohEYTIqIGc4JRzQdFy9dh1jE1dgXBxHnM7z6bPnuDlzDw4ngSQ5KYTDpNI5sKRMmEqlIPTQRMfzY5vmLS9keUKHk7UkNSU6SZPQT0+lP5niG2Zn4yQKX8rtO/chEtauzFs6ObezsKW43e7GUpiILSQUifGEx8Kp6Vm0ttlgtbZRrP/EZrNBFEUkEgkILNXIaIZL2ZGLkgvZxRxyK6sYHjWQMXQYhgFd15swjEbNZDKYGB/DjcnJxh0mBob4LQ5pI5DkDmRzS3jy/gfyH75iv3yIg8ohftH/tF6vN8G+l6s/8eV7Bd/2a/gN3KH6xAWvuE0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create secret\"\n        title=\"create secret\"\n        src=\"/static/1ebd495f50bd036839ab0cd5e4fec803/fcda8/create-secret.png\"\n        srcset=\"/static/1ebd495f50bd036839ab0cd5e4fec803/12f09/create-secret.png 148w,\n/static/1ebd495f50bd036839ab0cd5e4fec803/e4a3f/create-secret.png 295w,\n/static/1ebd495f50bd036839ab0cd5e4fec803/fcda8/create-secret.png 590w,\n/static/1ebd495f50bd036839ab0cd5e4fec803/efc66/create-secret.png 885w,\n/static/1ebd495f50bd036839ab0cd5e4fec803/c83ae/create-secret.png 1180w,\n/static/1ebd495f50bd036839ab0cd5e4fec803/57f7d/create-secret.png 2088w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Here is an example of the format of the secret:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">apiVersion: v1\nkind: Secret\nmetadata:\nname: seldon-init-container-secret\ntype: Opaque\ndata:\nAWS_ACCESS_KEY_ID: XXXX\nAWS_SECRET_ACCESS_KEY: XXXX\nAWS_ENDPOINT_URL: XXXX\nUSE_SSL: XXXX</code></pre></div>\n<p><em>Find documentation on how to configure different object storage providers <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/servers/kfserving-storage-initializer.html\">here</a></em>.</p>\n<ul class=\"pf-c-list\">\n<li>\n<p>First select an “Administrator” profile, then under Operators and Installed Operators you can add new Seldon Deployment in Seldon Core operator by clicking on <code class=\"language-text\">Create Instance</code>.</p>\n<ul class=\"pf-c-list\">\n<li>Select <code class=\"language-text\">YAML view</code> and enter your model deployment configuration. <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/time-to-merge-prediction/seldon-deployment-config.yaml\">Here</a> is an example deployment configuration which uses the Sklearn Server.</li>\n<li>Find more information on the formats of the deployment configs for other <a href=\"https://docs.seldon.io/projects/seldon-core/en/latest/nav/config/servers.html\">model servers here</a>.</li>\n</ul>\n</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/31fb271bd2cb7840facc8414ae6ce807/aaf7f/create-deployment.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 57.432432432432435%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABwUlEQVQoz42Te0/iQBTF+zXcdWV5iYi8QZRdFUXwFU1M9p99uJ8dMISi0ndLaTs93hmU8IrxJjeTyaS/nHvOrbSXKyKTLSAa30YiuYPEdhrfIjFc39zCcT2MDBfyyICialAUBZZlgTEGXmEYip4vKZXOIJ3JIRJNCND3WBIbX7dw3r5CEPjwPRf9fh+9Xg/Dpyc4zhi6YdBbMIO8g3lL1XoDd/e/0Gxd4rjRRP3nCUqVA/z99x+q5UE2GCaeTyAH4/EUZts2KVahahpUUu66roBx5VKufIiTsxZOm2006Pxx1EChvI/ffx6gm44YV9cNmKYpVPm+L07P82bNQTOFmWwe5eoB4uTf5lZ0NnL78gY2+TV6liHLMkF1fKakOIWQL1YEMJZIiVC+bEbQuiAPWYhHncEwTFI4VbkcyHJLHFIoVUllTUB5c4Uc6NNoA8WCPBwKlYPBAJPJZCXh+aQlDihVaiiSb8nU7gKQexWyQICDgIn7upVZAe7X6jisHwkoX6N54LPOgzHxotkLgA+BVQJm8yWx3AsjvyUa0BmGbK1nK0DuIR85VyhP/xYKhQMvKGWN9qzT6aDb7Yr1WP543f0ViQOomFR+wg0AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create deployment\"\n        title=\"create deployment\"\n        src=\"/static/31fb271bd2cb7840facc8414ae6ce807/fcda8/create-deployment.png\"\n        srcset=\"/static/31fb271bd2cb7840facc8414ae6ce807/12f09/create-deployment.png 148w,\n/static/31fb271bd2cb7840facc8414ae6ce807/e4a3f/create-deployment.png 295w,\n/static/31fb271bd2cb7840facc8414ae6ce807/fcda8/create-deployment.png 590w,\n/static/31fb271bd2cb7840facc8414ae6ce807/efc66/create-deployment.png 885w,\n/static/31fb271bd2cb7840facc8414ae6ce807/c83ae/create-deployment.png 1180w,\n/static/31fb271bd2cb7840facc8414ae6ce807/aaf7f/create-deployment.png 1668w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<ul class=\"pf-c-list\">\n<li>If you are using the SKLearn Seldon server, the <code class=\"language-text\">modeluri</code> refers to the model’s prefix in the Ceph bucket. In your Seldon Deployment, change model URI to be for your model. Sample model URI from S3: <code class=\"language-text\">s3://&lt;bucket_name&gt;/&lt;project_name&gt;/&lt;model_name&gt;/model.joblib</code></li>\n<li>In your Seldon Deployment, add a reference to the secret with the AWS credentials for access to the bucket like <code class=\"language-text\">envSecretRefName: seldon-init-container-secret</code>, where seldon-init-container-secret is the secret name.</li>\n<li>To test the deployed model endpoint, create a route to the deployed model by selecting the deployed service. To create a route, from the OpenShift console, go to <code class=\"language-text\">Networking</code>, then go to <code class=\"language-text\">Routes</code> and click on “Create Route”. Give the route a desired name, and select the service that we deployed earlier, select a “Target Port” and click on Create.</li>\n</ul>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 590px; \"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1f91041c80fae57cdbd2ab362997d881/46115/create-route.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 115.54054054054055%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB10lEQVQ4y6VUya7bMAz0d/d/eumlP9FDDz32VqBAWgSJ432JZUmWpxx5gZI42yuBAcMYojgcipExBlVV4Xw+o2ka5HnuY601nHNPgVGAcY0jHjydTh7H4xFKKWzZOI43oCnjUHfDHI+IWOF+v8fhcPCe1fEm/m+t9X4YhjVpeAGt7QdkrV3jyMkPHligtUEnVXadkmp7742xNwnvxVHf90iTRAKHR7ZFeasFEatKJGFZllJN58UJsVC/BzP7NSEPZFkmh1v/gRUTFIu4pvWMhU9IdfOiWEeFH5ybaIT9fYQLylQ2zwtPu65rP4/Exe/ZP03IuePBV+i88t1XOAkwCdK27eQDYThGZhaAI3SDa1GKvISR/jE5hVl8iJdF0Ubh99+fqEr2q177Rr+8cQr1SBAWtVZoB4u0iJGmmV8MC+UF7PGzhBdz2CiHpBlRqRGl7AVl8WGb5lB6t9vtkMQxeqlmue0d3MxhJlRTeS2xJCXNqS/24ZMLEb6o9enRL6/kvyhrSXQ4xv7pMek7m2Vz2/gVbjvoc4VWxkWpacCvNw9jgiNFimHC0KI/mcanr3t8+VGgFsXTRkR5kd6WRYkk+Pw9xbdfMtCyzstunqk3KF8kvHP9h8X5B5U4EB4hGsiAAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"create route\"\n        title=\"create route\"\n        src=\"/static/1f91041c80fae57cdbd2ab362997d881/fcda8/create-route.png\"\n        srcset=\"/static/1f91041c80fae57cdbd2ab362997d881/12f09/create-route.png 148w,\n/static/1f91041c80fae57cdbd2ab362997d881/e4a3f/create-route.png 295w,\n/static/1f91041c80fae57cdbd2ab362997d881/fcda8/create-route.png 590w,\n/static/1f91041c80fae57cdbd2ab362997d881/efc66/create-route.png 885w,\n/static/1f91041c80fae57cdbd2ab362997d881/c83ae/create-route.png 1180w,\n/static/1f91041c80fae57cdbd2ab362997d881/46115/create-route.png 1290w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;\"\n        loading=\"lazy\"\n      />\n  </a>\n    </span></p>\n<p>Once the route has been created, you can send a curl request to interact with the route like:</p>\n<p><code class=\"language-text\">curl -X POST -H &#39;Content-Type: application/json&#39; -d &#39;{&quot;data&quot;: { &quot;ndarray&quot;: [[1,2,3,4]]}}&#39; http://localhost:5000/api/v1.0/predictions</code></p>\n<p>You can also create a notebook such as <a href=\"https://github.com/aicoe-aiops/ocp-ci-analysis/blob/master/notebooks/time-to-merge-prediction/model_inference.ipynb\">this</a> to interact with the model and ensure that the service is running as intended.</p>\n</li>\n</ol>","fields":{"srcLink":"https://github.com/aicoe-aiops/data-science-workflows/blob/master/docs/serving_monitoring/deploy-models-using-seldon.md"},"frontmatter":{"title":"","description":null,"extraClasses":null,"banner":null}}},"pageContext":{"id":"d63a9f70-805e-5b53-b3e8-ba3aa66ff4cd"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}