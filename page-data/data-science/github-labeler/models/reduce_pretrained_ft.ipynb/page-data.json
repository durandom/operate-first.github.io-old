{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/github-labeler/models/reduce_pretrained_ft.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"051f324a-6b93-5ef9-bed2-f108d4f4689a >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Reduce Pretrained fastText</h1></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>This is a short, simple notebook that reduces the size of our pretrained fastText model. We do this by overlapping the large vocabulary set we have with all the words mentioned at least once in our target dataset. After reducing the vocabulary size with that method, we use PCA reduction to reduce our vector size. We then save our word vector file so the fastText model can access it in training.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>First we import our packages and load in our dataset and Word2Vec model from Ceph.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[1]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> re\n<span class=\"token\" style=\"color:#0000ff\">import</span> numpy <span class=\"token\" style=\"color:#0000ff\">as</span> np\n<span class=\"token\" style=\"color:#0000ff\">from</span> nltk<span class=\"token\" style=\"color:#393A34\">.</span>tokenize <span class=\"token\" style=\"color:#0000ff\">import</span> word_tokenize\n<span class=\"token\" style=\"color:#0000ff\">import</span> nltk\n<span class=\"token\" style=\"color:#0000ff\">from</span> gensim<span class=\"token\" style=\"color:#393A34\">.</span>models <span class=\"token\" style=\"color:#0000ff\">import</span> Word2Vec\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> find_dotenv<span class=\"token\" style=\"color:#393A34\">,</span> load_dotenv\n<span class=\"token\" style=\"color:#0000ff\">import</span> boto3\n<span class=\"token\" style=\"color:#0000ff\">import</span> sys\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>decomposition <span class=\"token\" style=\"color:#0000ff\">import</span> PCA\n<span class=\"token\" style=\"color:#0000ff\">from</span> collections <span class=\"token\" style=\"color:#0000ff\">import</span> Counter\n\nvocab_path <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;../src/data&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">if</span> vocab_path <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> sys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">:</span>\n    sys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>insert<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> vocab_path<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">from</span> preprocess <span class=\"token\" style=\"color:#0000ff\">import</span> preprocess <span class=\"token\" style=\"color:#008000;font-style:italic\"># noqa</span>\n\nnltk<span class=\"token\" style=\"color:#393A34\">.</span>download<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;punkt&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stderr\"><span>[nltk_data] Downloading package stopwords to /opt/app-\n[nltk_data]     root/src/nltk_data...\n[nltk_data]   Package stopwords is already up-to-date!\n[nltk_data] Downloading package punkt to /opt/app-\n[nltk_data]     root/src/nltk_data...\n[nltk_data]   Package punkt is already up-to-date!\n[nltk_data] Downloading package punkt to /opt/app-\n[nltk_data]     root/src/nltk_data...\n[nltk_data]   Package punkt is already up-to-date!\n</span></code><pre><code><span>True</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">load_dotenv<span class=\"token\" style=\"color:#393A34\">(</span>find_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>True</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># whether to use ceph or store locally</span>\n\nuse_ceph <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">bool</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">int</span><span class=\"token\" style=\"color:#393A34\">(</span>os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;USE_CEPH&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    s3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;OBJECT_STORAGE_ENDPOINT_URL&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_access_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_secret_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_bucket <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;OBJECT_STORAGE_BUCKET_NAME&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n    s3 <span class=\"token\" style=\"color:#393A34\">=</span> boto3<span class=\"token\" style=\"color:#393A34\">.</span>client<span class=\"token\" style=\"color:#393A34\">(</span>\n        service_name<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;s3&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        aws_access_key_id<span class=\"token\" style=\"color:#393A34\">=</span>s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span>\n        aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">=</span>s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span>\n        endpoint_url<span class=\"token\" style=\"color:#393A34\">=</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">name <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;REPO_NAME&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span> <span class=\"token\" style=\"color:#0000ff\">in</span> name<span class=\"token\" style=\"color:#393A34\">:</span>\n    REPO <span class=\"token\" style=\"color:#393A34\">=</span> name\n    USER <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span>\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    USER <span class=\"token\" style=\"color:#393A34\">=</span> name\n    REPO <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[5]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># repo data is saved as {org_name}-_-{repo_name}</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># orginization data is saved as {org_name}</span>\n\nsavename <span class=\"token\" style=\"color:#393A34\">=</span> USER <span class=\"token\" style=\"color:#0000ff\">if</span> USER <span class=\"token\" style=\"color:#0000ff\">else</span> REPO<span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;/&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;-_-&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\npath <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;../data&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> savename <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot;.csv&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nkey <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;github-labeler/data/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>savename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.csv&quot;</span></span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    response <span class=\"token\" style=\"color:#393A34\">=</span> s3<span class=\"token\" style=\"color:#393A34\">.</span>get_object<span class=\"token\" style=\"color:#393A34\">(</span>Bucket<span class=\"token\" style=\"color:#393A34\">=</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span> Key<span class=\"token\" style=\"color:#393A34\">=</span>key<span class=\"token\" style=\"color:#393A34\">)</span>\n    issues_df <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>response<span class=\"token\" style=\"color:#393A34\">.</span>get<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>drop_duplicates<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    issues_df <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>read_csv<span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>drop_duplicates<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">pattern <span class=\"token\" style=\"color:#393A34\">=</span> re<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">compile</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;github-labeler/w2v/.*&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nbuck <span class=\"token\" style=\"color:#393A34\">=</span> boto3<span class=\"token\" style=\"color:#393A34\">.</span>resource<span class=\"token\" style=\"color:#393A34\">(</span>\n    service_name<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;s3&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    aws_access_key_id<span class=\"token\" style=\"color:#393A34\">=</span>s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span>\n    aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">=</span>s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span>\n    endpoint_url<span class=\"token\" style=\"color:#393A34\">=</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span>\n<span class=\"token\" style=\"color:#393A34\">)</span>\n\nkeys <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#0000ff\">for</span> obj <span class=\"token\" style=\"color:#0000ff\">in</span> buck<span class=\"token\" style=\"color:#393A34\">.</span>Bucket<span class=\"token\" style=\"color:#393A34\">(</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>objects<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">all</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> pattern<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>obj<span class=\"token\" style=\"color:#393A34\">.</span>key<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        keys<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>obj<span class=\"token\" style=\"color:#393A34\">.</span>key<span class=\"token\" style=\"color:#393A34\">)</span>\n\nkeys <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>basename<span class=\"token\" style=\"color:#393A34\">(</span>key<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> key <span class=\"token\" style=\"color:#0000ff\">in</span> keys<span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[7]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> key <span class=\"token\" style=\"color:#0000ff\">in</span> keys<span class=\"token\" style=\"color:#393A34\">:</span>\n        response <span class=\"token\" style=\"color:#393A34\">=</span> s3<span class=\"token\" style=\"color:#393A34\">.</span>get_object<span class=\"token\" style=\"color:#393A34\">(</span>\n            Bucket<span class=\"token\" style=\"color:#393A34\">=</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span>\n            Key<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;github-labeler/w2v/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>key<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">with</span> <span class=\"token builtin\">open</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;../models/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>key<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&#x27;</span></span> <span class=\"token\" style=\"color:#393A34\">,</span><span class=\"token\" style=\"color:#A31515\">&#x27;wb&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> f<span class=\"token\" style=\"color:#393A34\">:</span>\n            <span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> response<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;Body&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">:</span>\n                f<span class=\"token\" style=\"color:#393A34\">.</span>write<span class=\"token\" style=\"color:#393A34\">(</span>i<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[8]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">w <span class=\"token\" style=\"color:#393A34\">=</span> Word2Vec<span class=\"token\" style=\"color:#393A34\">.</span>load<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/w2v.model&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nfull_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>w<span class=\"token\" style=\"color:#393A34\">.</span>wv<span class=\"token\" style=\"color:#393A34\">.</span>index_to_key<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Now we generate all the words that are mentioned in our dataset and intersect it with the pre-trained Word2Vec model.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">cnt <span class=\"token\" style=\"color:#393A34\">=</span> Counter<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">for</span> i<span class=\"token\" style=\"color:#393A34\">,</span> row <span class=\"token\" style=\"color:#0000ff\">in</span> issues_df<span class=\"token\" style=\"color:#393A34\">.</span>iterrows<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># Here we call the preprocessing function defined for the w2v model so our way of counting words is consistent</span>\n    <span class=\"token\" style=\"color:#008000;font-style:italic\"># We tokenize each issue into words and count up the words</span>\n    words <span class=\"token\" style=\"color:#393A34\">=</span> word_tokenize<span class=\"token\" style=\"color:#393A34\">(</span>preprocess<span class=\"token\" style=\"color:#393A34\">(</span>row<span class=\"token\" style=\"color:#393A34\">.</span>title <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&quot; SEP &quot;</span> <span class=\"token\" style=\"color:#393A34\">+</span> row<span class=\"token\" style=\"color:#393A34\">.</span>body <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token builtin\">type</span><span class=\"token\" style=\"color:#393A34\">(</span>row<span class=\"token\" style=\"color:#393A34\">.</span>body<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token builtin\">str</span> <span class=\"token\" style=\"color:#0000ff\">else</span> row<span class=\"token\" style=\"color:#393A34\">.</span>title<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    cnt<span class=\"token\" style=\"color:#393A34\">.</span>update<span class=\"token\" style=\"color:#393A34\">(</span>words<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">shared_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>cnt<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>intersection<span class=\"token\" style=\"color:#393A34\">(</span>full_vocab<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>shared_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> words in reduced model&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>13622 words in reduced model\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">shared_vocab_dict <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> shared_vocab<span class=\"token\" style=\"color:#393A34\">:</span>\n    shared_vocab_dict<span class=\"token\" style=\"color:#393A34\">[</span>v<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> w<span class=\"token\" style=\"color:#393A34\">.</span>wv<span class=\"token\" style=\"color:#393A34\">[</span>v<span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We perform PCA reduction such that we retain 70% of the total singular value sizes. 70% is an arbitrary value and can be changed, but it is a common value to use in data science for PCA reductions. In this particular context we are willing to give up accuracy for a smaller model size.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[13]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">pca_in <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>stack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>b <span class=\"token\" style=\"color:#0000ff\">for</span> _<span class=\"token\" style=\"color:#393A34\">,</span> b <span class=\"token\" style=\"color:#0000ff\">in</span> shared_vocab_dict<span class=\"token\" style=\"color:#393A34\">.</span>items<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\nwords <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>a <span class=\"token\" style=\"color:#0000ff\">for</span> a<span class=\"token\" style=\"color:#393A34\">,</span> _ <span class=\"token\" style=\"color:#0000ff\">in</span> shared_vocab_dict<span class=\"token\" style=\"color:#393A34\">.</span>items<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\npca <span class=\"token\" style=\"color:#393A34\">=</span> PCA<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\npca<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>pca_in<span class=\"token\" style=\"color:#393A34\">)</span>\nsum_svs <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>pca<span class=\"token\" style=\"color:#393A34\">.</span>singular_values_<span class=\"token\" style=\"color:#393A34\">)</span>\ndim <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\nrunning <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> i <span class=\"token\" style=\"color:#0000ff\">in</span> pca<span class=\"token\" style=\"color:#393A34\">.</span>singular_values_<span class=\"token\" style=\"color:#393A34\">:</span>\n    dim <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    running <span class=\"token\" style=\"color:#393A34\">+=</span> i\n    <span class=\"token\" style=\"color:#0000ff\">if</span> running<span class=\"token\" style=\"color:#393A34\">/</span>sum_svs <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">0.7</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">break</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>dim<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> dimensions in reduced model&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n\npca <span class=\"token\" style=\"color:#393A34\">=</span> PCA<span class=\"token\" style=\"color:#393A34\">(</span>n_components<span class=\"token\" style=\"color:#393A34\">=</span>dim<span class=\"token\" style=\"color:#393A34\">)</span>\npca_out <span class=\"token\" style=\"color:#393A34\">=</span> pca<span class=\"token\" style=\"color:#393A34\">.</span>fit_transform<span class=\"token\" style=\"color:#393A34\">(</span>pca_in<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>78 dimensions in reduced model\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[14]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">with</span> <span class=\"token builtin\">open</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;vocab_reduced.vec&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;w&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> encoding <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;utf-8&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> f<span class=\"token\" style=\"color:#393A34\">:</span>\n    f<span class=\"token\" style=\"color:#393A34\">.</span>write<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">str</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>shared_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27; &#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token builtin\">str</span><span class=\"token\" style=\"color:#393A34\">(</span>dim<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27;\\n&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> w<span class=\"token\" style=\"color:#393A34\">,</span> vec <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">zip</span><span class=\"token\" style=\"color:#393A34\">(</span>words<span class=\"token\" style=\"color:#393A34\">,</span> pca_out<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        vector <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token builtin\">str</span><span class=\"token\" style=\"color:#393A34\">(</span>v<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> vec<span class=\"token\" style=\"color:#393A34\">]</span>\n        f<span class=\"token\" style=\"color:#393A34\">.</span>write<span class=\"token\" style=\"color:#393A34\">(</span>w <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27; &#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27; &#x27;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>vector<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n        f<span class=\"token\" style=\"color:#393A34\">.</span>write<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;\\n&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We upload this reduced vector file to Ceph and delete the large Word2Vec files.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[15]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    s3<span class=\"token\" style=\"color:#393A34\">.</span>upload_file<span class=\"token\" style=\"color:#393A34\">(</span>\n        Bucket<span class=\"token\" style=\"color:#393A34\">=</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span>\n        Key<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;github-labeler/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>savename<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/vocab_reduced.vec&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n        Filename<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;vocab_reduced.vec&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[17]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    w2v_pattern <span class=\"token\" style=\"color:#393A34\">=</span> re<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">compile</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;w2v.*&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> item <span class=\"token\" style=\"color:#0000ff\">in</span> os<span class=\"token\" style=\"color:#393A34\">.</span>listdir<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>w2v_pattern<span class=\"token\" style=\"color:#393A34\">,</span> item<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            os<span class=\"token\" style=\"color:#393A34\">.</span>remove<span class=\"token\" style=\"color:#393A34\">(</span>os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> item<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    os<span class=\"token\" style=\"color:#393A34\">.</span>remove<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;vocab_reduced.vec&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/github-labeler/blob/master/models/reduce_pretrained_ft.ipynb"}}},"pageContext":{"id":"051f324a-6b93-5ef9-bed2-f108d4f4689a >>> JupyterNotebook"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}