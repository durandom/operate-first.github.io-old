{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/github-labeler/src/data/build_w2v_vocab.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"c4f7643d-93b7-52f2-85b8-521f7c84e270 >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>Build W2V Vocab</h1></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>In this notebook we can give a W2V model a set vocabulary before training it on github issues. We do this by counting words from several days of github issues, and saving the most popular ones. We download a pre-trained model from the fastText team and reduce the size as much as we can. We then add in the additional vocabulary we picked up from the several days of github issues.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Environment Variables</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We load in our environment variables and create our Ceph client, as usual.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">from</span> google<span class=\"token\" style=\"color:#393A34\">.</span>cloud <span class=\"token\" style=\"color:#0000ff\">import</span> bigquery\n<span class=\"token\" style=\"color:#0000ff\">from</span> google<span class=\"token\" style=\"color:#393A34\">.</span>oauth2 <span class=\"token\" style=\"color:#0000ff\">import</span> service_account\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> numpy <span class=\"token\" style=\"color:#0000ff\">as</span> np\n<span class=\"token\" style=\"color:#0000ff\">import</span> urllib\n<span class=\"token\" style=\"color:#0000ff\">import</span> zipfile\n<span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">from</span> nltk<span class=\"token\" style=\"color:#393A34\">.</span>tokenize <span class=\"token\" style=\"color:#0000ff\">import</span> word_tokenize\n<span class=\"token\" style=\"color:#0000ff\">import</span> nltk\n<span class=\"token\" style=\"color:#0000ff\">from</span> collections <span class=\"token\" style=\"color:#0000ff\">import</span> Counter\n<span class=\"token\" style=\"color:#0000ff\">from</span> tqdm<span class=\"token\" style=\"color:#393A34\">.</span>notebook <span class=\"token\" style=\"color:#0000ff\">import</span> tqdm\n<span class=\"token\" style=\"color:#0000ff\">from</span> gensim<span class=\"token\" style=\"color:#393A34\">.</span>models <span class=\"token\" style=\"color:#0000ff\">import</span> Word2Vec<span class=\"token\" style=\"color:#393A34\">,</span> KeyedVectors\n<span class=\"token\" style=\"color:#0000ff\">import</span> unicodedata <span class=\"token\" style=\"color:#0000ff\">as</span> ud\n<span class=\"token\" style=\"color:#0000ff\">from</span> sklearn<span class=\"token\" style=\"color:#393A34\">.</span>decomposition <span class=\"token\" style=\"color:#0000ff\">import</span> PCA\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> find_dotenv<span class=\"token\" style=\"color:#393A34\">,</span> load_dotenv\n<span class=\"token\" style=\"color:#0000ff\">import</span> boto3\n<span class=\"token\" style=\"color:#0000ff\">from</span> w2v_preprocess <span class=\"token\" style=\"color:#0000ff\">import</span> remove_quotes<span class=\"token\" style=\"color:#393A34\">,</span> is_bot<span class=\"token\" style=\"color:#393A34\">,</span> is_english<span class=\"token\" style=\"color:#393A34\">,</span> preprocess<span class=\"token\" style=\"color:#393A34\">,</span> is_punc\n\nnltk<span class=\"token\" style=\"color:#393A34\">.</span>download<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;punkt&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stderr\"><span>[nltk_data] Downloading package punkt to /home/atersaak/nltk_data...\n[nltk_data]   Package punkt is already up-to-date!\n</span></code><pre><code><span>True</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">load_dotenv<span class=\"token\" style=\"color:#393A34\">(</span>find_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>True</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[27]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># whether to use ceph or store locally</span>\n\nuse_ceph <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">bool</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">int</span><span class=\"token\" style=\"color:#393A34\">(</span>os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;USE_CEPH&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    s3_endpoint_url <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;OBJECT_STORAGE_ENDPOINT_URL&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_access_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;AWS_ACCESS_KEY_ID&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_secret_key <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;AWS_SECRET_ACCESS_KEY&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    s3_bucket <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>environ<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;OBJECT_STORAGE_BUCKET_NAME&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n    s3 <span class=\"token\" style=\"color:#393A34\">=</span> boto3<span class=\"token\" style=\"color:#393A34\">.</span>client<span class=\"token\" style=\"color:#393A34\">(</span>\n        service_name<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;s3&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        aws_access_key_id<span class=\"token\" style=\"color:#393A34\">=</span>s3_access_key<span class=\"token\" style=\"color:#393A34\">,</span>\n        aws_secret_access_key<span class=\"token\" style=\"color:#393A34\">=</span>s3_secret_key<span class=\"token\" style=\"color:#393A34\">,</span>\n        endpoint_url<span class=\"token\" style=\"color:#393A34\">=</span>s3_endpoint_url<span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>GHArchive Extraction</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We extract several days of github issues using GHArchive. Similar to the SVM preprocessing, we create word counts and save the top words that make up 95% of all the words used.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>First a google cloud project has to be made in order to use BigQuery to access the <a href=\"https://www.gharchive.org/\">GHArchive</a>. The service account credentials can be stored in the root folder and the project id should match the one below. </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># save key .json file in the github labeler root</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># project id on bigquery account should match</span>\n\ncredentials <span class=\"token\" style=\"color:#393A34\">=</span> service_account<span class=\"token\" style=\"color:#393A34\">.</span>Credentials<span class=\"token\" style=\"color:#393A34\">.</span>from_service_account_file<span class=\"token\" style=\"color:#393A34\">(</span>\n    <span class=\"token\" style=\"color:#A31515\">&#x27;../../github-issue-data-extraction-key.json&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nproject_id <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&#x27;github-issue-data-extraction&#x27;</span>\nclient <span class=\"token\" style=\"color:#393A34\">=</span> bigquery<span class=\"token\" style=\"color:#393A34\">.</span>Client<span class=\"token\" style=\"color:#393A34\">(</span>credentials<span class=\"token\" style=\"color:#393A34\">=</span> credentials<span class=\"token\" style=\"color:#393A34\">,</span> project<span class=\"token\" style=\"color:#393A34\">=</span>project_id<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We make a function that can take in a given day and return a dataframe of the github issues made on that day, with some light processing applied.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">get_data_for_day</span><span class=\"token\" style=\"color:#393A34\">(</span>day<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token triple-quoted-string\" style=\"color:#A31515\">&quot;&quot;&quot;\n    Pass in a datetime object and a dataframe of all the issue data from that day will be returned\n    &quot;&quot;&quot;</span>\n    date <span class=\"token\" style=\"color:#393A34\">=</span> day<span class=\"token\" style=\"color:#393A34\">.</span>strftime<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;%Y%m%d&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    response <span class=\"token\" style=\"color:#393A34\">=</span> client<span class=\"token\" style=\"color:#393A34\">.</span>query<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;&quot;&quot;SELECT JSON_EXTRACT(payload, &#x27;$.issue.title&#x27;) as title,\n                                JSON_EXTRACT(payload, &#x27;$.issue.body&#x27;) as body,\n                                JSON_EXTRACT(payload, &#x27;$.issue.html_url&#x27;) as url,\n                                JSON_EXTRACT(payload, &#x27;$.issue.user.login&#x27;) as actor\n                                FROM githubarchive.day.</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>date<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">\n                                WHERE type = &#x27;IssuesEvent&#x27; AND JSON_EXTRACT(payload, &#x27;$.action&#x27;) = &#x27;&quot;opened&quot;&#x27;\n                                &quot;&quot;&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> response<span class=\"token\" style=\"color:#393A34\">.</span>to_dataframe<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> df\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">process_df</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> col <span class=\"token\" style=\"color:#0000ff\">in</span> df<span class=\"token\" style=\"color:#393A34\">.</span>columns<span class=\"token\" style=\"color:#393A34\">:</span>\n        df<span class=\"token\" style=\"color:#393A34\">[</span>col<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span>col<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>remove_quotes<span class=\"token\" style=\"color:#393A34\">)</span>\n        df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">~</span>df<span class=\"token\" style=\"color:#393A34\">[</span>col<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>is_bot<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">~</span>df<span class=\"token\" style=\"color:#393A34\">[</span>col<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>is_bot<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> df</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Now we will extract the github data to create a vocabulary set. A certain number of days can be specified here, and the data will begin from issues a week ago and continue extracting one day from every two weeks. The data is not saved, but the word counts are stored.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[ ]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># here we download some data spaced out over about two years to build vocabulary</span>\n\n\ntotal_data <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n\ncurr_day <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>today<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>date<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">-</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>timedelta<span class=\"token\" style=\"color:#393A34\">(</span>days <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nnum_days <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n\ncnt <span class=\"token\" style=\"color:#393A34\">=</span> Counter<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">while</span> num_days <span class=\"token\" style=\"color:#393A34\">&lt;</span> <span class=\"token\" style=\"color:#36acaa\">50</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> get_data_for_day<span class=\"token\" style=\"color:#393A34\">(</span>curr_day<span class=\"token\" style=\"color:#393A34\">)</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> process_df<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;title&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27; &#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#A31515\">&#x27; SEP &#x27;</span> <span class=\"token\" style=\"color:#393A34\">+</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;body&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>fillna<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27; &#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> inp<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>preprocess<span class=\"token\" style=\"color:#393A34\">)</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> inp<span class=\"token\" style=\"color:#393A34\">[</span>inp<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>is_english<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> inp<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> x<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> inp<span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>word_tokenize<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>values\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">[</span>word <span class=\"token\" style=\"color:#0000ff\">for</span> word <span class=\"token\" style=\"color:#0000ff\">in</span> issue <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> is_punc<span class=\"token\" style=\"color:#393A34\">(</span>word<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> issue <span class=\"token\" style=\"color:#0000ff\">in</span> inp<span class=\"token\" style=\"color:#393A34\">]</span>\n    inp <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>words<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> words <span class=\"token\" style=\"color:#0000ff\">in</span> inp<span class=\"token\" style=\"color:#393A34\">]</span>\n    total_data <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">.</span>memory_usage<span class=\"token\" style=\"color:#393A34\">(</span>deep <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">/</span><span class=\"token\" style=\"color:#36acaa\">1000000000</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#393A34\">(</span>num_days <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">%</span> <span class=\"token\" style=\"color:#36acaa\">3</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>num_days<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> days and </span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">round</span><span class=\"token\" style=\"color:#393A34\">(</span>total_data<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> GB looked at&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    curr_day <span class=\"token\" style=\"color:#393A34\">-=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>timedelta<span class=\"token\" style=\"color:#393A34\">(</span>days <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">14</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    num_days <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> d <span class=\"token\" style=\"color:#0000ff\">in</span> inp<span class=\"token\" style=\"color:#393A34\">:</span>\n        cnt<span class=\"token\" style=\"color:#393A34\">.</span>update<span class=\"token\" style=\"color:#393A34\">(</span>d<span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>cnt<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> total words&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Download, Append To, and Reduce Pretrained Model</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We download the pretrained model that was trained on wikipedia and the news. We delete noisy words that are unlikely to come up to reduce the size of the model using some criteria, such as no uppercase. We use PCA to reduce the vector size of the words from the pretrained model. We do this by looking at the sum of the singular values and making sure 70% of the sum of the SV&#x27;s are covered by the reduced data&#x27;s SV&#x27;s. We then take the most popular words from github issues not already in our vocabulary and add them in.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># download pretrained english model</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> os<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>isfile<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/wiki-news-300d-1M.vec&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    urllib<span class=\"token\" style=\"color:#393A34\">.</span>urlretrieve<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;https://dl.fbaipublicfiles.com/fasttext/vectors-english/wiki-news-300d-1M.vec.zip&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n                       <span class=\"token\" style=\"color:#A31515\">&quot;../models/wiki-news-300d-1M.vec.zip&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">with</span> zipfile<span class=\"token\" style=\"color:#393A34\">.</span>ZipFile<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/wiki-news-300d-1M.vec.zip&#x27;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;r&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">as</span> zip_ref<span class=\"token\" style=\"color:#393A34\">:</span>\n        zip_ref<span class=\"token\" style=\"color:#393A34\">.</span>extractall<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    os<span class=\"token\" style=\"color:#393A34\">.</span>remove<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/wiki-news-300d-1M.vec.zip&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[11]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">model <span class=\"token\" style=\"color:#393A34\">=</span> KeyedVectors<span class=\"token\" style=\"color:#393A34\">.</span>load_word2vec_format<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../models/wiki-news-300d-1M.vec&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Here we loaded in a model that contains a vocabulary of 1 million words in 300 dimensions.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[12]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>model<span class=\"token\" style=\"color:#393A34\">.</span>vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># remove capital letters</span>\npretrained_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>v <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> model<span class=\"token\" style=\"color:#393A34\">.</span>vocab<span class=\"token\" style=\"color:#393A34\">.</span>keys<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">if</span> v<span class=\"token\" style=\"color:#393A34\">.</span>lower<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">==</span> v<span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># remove bigrams</span>\npretrained_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>v <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> pretrained_vocab <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>v<span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;-&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&lt;</span> <span class=\"token\" style=\"color:#36acaa\">2</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># remove words with nonlatin characters</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># from stackexchange</span>\n\nlatin_letters<span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token\" style=\"color:#393A34\">}</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">is_latin</span><span class=\"token\" style=\"color:#393A34\">(</span>uchr<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">try</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> latin_letters<span class=\"token\" style=\"color:#393A34\">[</span>uchr<span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">except</span> KeyError<span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> latin_letters<span class=\"token\" style=\"color:#393A34\">.</span>setdefault<span class=\"token\" style=\"color:#393A34\">(</span>uchr<span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&#x27;LATIN&#x27;</span> <span class=\"token\" style=\"color:#0000ff\">in</span> ud<span class=\"token\" style=\"color:#393A34\">.</span>name<span class=\"token\" style=\"color:#393A34\">(</span>uchr<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">only_roman_chars</span><span class=\"token\" style=\"color:#393A34\">(</span>unistr<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token builtin\">all</span><span class=\"token\" style=\"color:#393A34\">(</span>is_latin<span class=\"token\" style=\"color:#393A34\">(</span>uchr<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> uchr <span class=\"token\" style=\"color:#0000ff\">in</span> unistr <span class=\"token\" style=\"color:#0000ff\">if</span> uchr<span class=\"token\" style=\"color:#393A34\">.</span>isalpha<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\npretrained_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>v <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> pretrained_vocab <span class=\"token\" style=\"color:#0000ff\">if</span> only_roman_chars<span class=\"token\" style=\"color:#393A34\">(</span>v<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\ndigits <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;0123456789&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">is_mostly_numeric</span><span class=\"token\" style=\"color:#393A34\">(</span>string<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    cnt <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> s <span class=\"token\" style=\"color:#0000ff\">in</span> string<span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> s <span class=\"token\" style=\"color:#0000ff\">in</span> digits<span class=\"token\" style=\"color:#393A34\">:</span>\n            cnt <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> cnt<span class=\"token\" style=\"color:#393A34\">/</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>string<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">.5</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#36acaa\">False</span>\n\n\npretrained_vocab <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>v <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> pretrained_vocab <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#0000ff\">not</span> is_mostly_numeric<span class=\"token\" style=\"color:#393A34\">(</span>v<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>999994\n392610\n296866\n284422\n244220\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Here we can see the vocab size reduce a little after each step.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We add in the vocabulary found in github issues.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[19]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">vocab_set <span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token builtin\">set</span><span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span>\ntotal_num <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>b <span class=\"token\" style=\"color:#0000ff\">for</span> a<span class=\"token\" style=\"color:#393A34\">,</span> b <span class=\"token\" style=\"color:#0000ff\">in</span> cnt<span class=\"token\" style=\"color:#393A34\">.</span>most_common<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\ntop_words <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\ncutoff <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0.95</span><span class=\"token\" style=\"color:#393A34\">*</span>total_num\nrunning <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> word<span class=\"token\" style=\"color:#393A34\">,</span> num <span class=\"token\" style=\"color:#0000ff\">in</span> cnt<span class=\"token\" style=\"color:#393A34\">.</span>most_common<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">if</span> running <span class=\"token\" style=\"color:#393A34\">&lt;</span> cutoff<span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> word <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> vocab_set<span class=\"token\" style=\"color:#393A34\">:</span>\n            top_words<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>word<span class=\"token\" style=\"color:#393A34\">)</span>\n        running <span class=\"token\" style=\"color:#393A34\">+=</span> num\n    <span class=\"token\" style=\"color:#0000ff\">else</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">break</span>\n<span class=\"token\" style=\"color:#0000ff\">del</span> cnt\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>top_words<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> words added from random github issues&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>142484 words added from random github issues\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We use PCA to reduce the size of the pre-trained vectors here.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[20]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># reduce size</span>\n\ndata <span class=\"token\" style=\"color:#393A34\">=</span> np<span class=\"token\" style=\"color:#393A34\">.</span>stack<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>model<span class=\"token\" style=\"color:#393A34\">[</span>v<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> pretrained_vocab<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\npca <span class=\"token\" style=\"color:#393A34\">=</span> PCA<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\npca<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">)</span>\n\ntotal_singular_values <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token builtin\">sum</span><span class=\"token\" style=\"color:#393A34\">(</span>pca<span class=\"token\" style=\"color:#393A34\">.</span>singular_values_<span class=\"token\" style=\"color:#393A34\">)</span>\n\nthresh <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0.7</span>\nrunning <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\nn_comps <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#36acaa\">0</span>\n<span class=\"token\" style=\"color:#0000ff\">while</span> running <span class=\"token\" style=\"color:#393A34\">&lt;</span> thresh<span class=\"token\" style=\"color:#393A34\">*</span>total_singular_values<span class=\"token\" style=\"color:#393A34\">:</span>\n    running <span class=\"token\" style=\"color:#393A34\">+=</span> pca<span class=\"token\" style=\"color:#393A34\">.</span>singular_values_<span class=\"token\" style=\"color:#393A34\">[</span>n_comps<span class=\"token\" style=\"color:#393A34\">]</span>\n    n_comps <span class=\"token\" style=\"color:#393A34\">+=</span> <span class=\"token\" style=\"color:#36acaa\">1</span>\n\n<span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>n_comps<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> components explain </span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>thresh<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> of the variation&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n\nfinal_pca <span class=\"token\" style=\"color:#393A34\">=</span> PCA<span class=\"token\" style=\"color:#393A34\">(</span>n_components <span class=\"token\" style=\"color:#393A34\">=</span> n_comps<span class=\"token\" style=\"color:#393A34\">)</span>\nfinal_pca<span class=\"token\" style=\"color:#393A34\">.</span>fit<span class=\"token\" style=\"color:#393A34\">(</span>data<span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>175 components explain 0.7 of the variation\n</span></code><pre><code><span>PCA(n_components=175)</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>The dimensionality here is the new dimensionality of our model, down from 300.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h2>Create W2V Model and Save</h2></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>Now we initialize our Word2Vec model and build the vocabulary. We join the resulting words from the pretrained model, add in the new words discovered from the issue data, as well as an &quot;unknown&quot; character.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[21]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">w <span class=\"token\" style=\"color:#393A34\">=</span> Word2Vec<span class=\"token\" style=\"color:#393A34\">(</span>size<span class=\"token\" style=\"color:#393A34\">=</span>n_comps<span class=\"token\" style=\"color:#393A34\">,</span> window<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">,</span> min_count<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> workers<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">4</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stderr\"><span>/home/atersaak/anaconda3/lib/python3.8/site-packages/gensim/models/base_any2vec.py:742: UserWarning: C extension not loaded, training will be slow. Install a C compiler and reinstall gensim for fast training.\n  warnings.warn(\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[22]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">w<span class=\"token\" style=\"color:#393A34\">.</span>build_vocab<span class=\"token\" style=\"color:#393A34\">(</span>sentences <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>pretrained_vocab <span class=\"token\" style=\"color:#393A34\">+</span> top_words <span class=\"token\" style=\"color:#393A34\">+</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&#x27;_unknown_&#x27;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[23]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">for</span> v <span class=\"token\" style=\"color:#0000ff\">in</span> tqdm<span class=\"token\" style=\"color:#393A34\">(</span>pretrained_vocab<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    w<span class=\"token\" style=\"color:#393A34\">.</span>wv<span class=\"token\" style=\"color:#393A34\">[</span>v<span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> final_pca<span class=\"token\" style=\"color:#393A34\">.</span>transform<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">[</span>model<span class=\"token\" style=\"color:#393A34\">[</span>v<span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span>\n<span class=\"token\" style=\"color:#0000ff\">del</span> model</code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><pre><code><span>  0%|          | 0/244220 [00:00&lt;?, ?it/s]</span></code></pre></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><p>We save the model in Ceph. Since it stores multiple files, we must account for this.</p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[51]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\">w<span class=\"token\" style=\"color:#393A34\">.</span>save<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../../models/w2v.model&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> use_ceph<span class=\"token\" style=\"color:#393A34\">:</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> <span class=\"token builtin\">file</span> <span class=\"token\" style=\"color:#0000ff\">in</span> os<span class=\"token\" style=\"color:#393A34\">.</span>listdir<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&#x27;../../models/&#x27;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n        <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&#x27;w2v.model&#x27;</span> <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">file</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            response <span class=\"token\" style=\"color:#393A34\">=</span> s3<span class=\"token\" style=\"color:#393A34\">.</span>upload_file<span class=\"token\" style=\"color:#393A34\">(</span>\n                Bucket<span class=\"token\" style=\"color:#393A34\">=</span>s3_bucket<span class=\"token\" style=\"color:#393A34\">,</span>\n                Key<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;github-labeler/w2v/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">file</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n                Filename<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;../../models/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">file</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">,</span>\n            <span class=\"token\" style=\"color:#393A34\">)</span>\n            os<span class=\"token\" style=\"color:#393A34\">.</span>remove<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&#x27;../../models/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span><span class=\"token builtin\">file</span><span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&#x27;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/github-labeler/blob/master/src/data/build_w2v_vocab.ipynb"}}},"pageContext":{"id":"c4f7643d-93b7-52f2-85b8-521f7c84e270 >>> JupyterNotebook"}},"staticQueryHashes":["1764348645","2823140819","3000541721","3606484676"]}